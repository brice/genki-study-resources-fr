!function(e,t){"use strict";var i={stats:{problems:0,solved:0,mistakes:0,score:0,exclude:0},canNotify:"Notification"in e,isTouch:"ontouchstart"in e||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,isTouching:!1,isTimerPausedByPopup:!1,feedbackMode:storageOK&&localStorage.feedbackMode?localStorage.feedbackMode:"classic",dataBackupReminderCount:storageOK&&localStorage.dataBackupReminderCount?+localStorage.dataBackupReminderCount:0,textSelectMode:!1,strokeNumberDisplay:!1,markedItem:null,ed:"lessons"+(/lessons-3rd/.test(e.location.pathname)?"-3rd":""),local:"file:"==e.location.protocol?"index.html":"",debug:/debug/.test(e.location.search)?"?debug":"",lang:{std_drag:"Faites glisser l'expression anglaise vers l'expression japonaise qui a la même signification.<br>CONSEIL : Cliquez sur une expression pour la marquer, puis cliquez sur un champ vide pour déposer la réponse.",std_kana:"Faites glisser le Kana vers le Romaji correspondant.<br>CONSEIL : Cliquez sur le kana pour le marquer, puis cliquez sur un champ vide pour déposer la réponse.",std_num:"Faites glisser les chiffres vers le Kana correspondant.<br>CONSEIL : Cliquez sur un chiffre pour le marquer, puis cliquez sur un champ vide pour déposer la réponse.",std_multi:"Résolvez les problèmes en choisissant les bonnes réponses.",std_questions:"Répondez aux questions du mieux que vous pouvez.",std_culture:"Répondez aux questions sur la culture japonaise du mieux que vous pouvez.",std_stroke_order:"Entraînez-vous à dessiner chaque kanji en suivant l'ordre des traits.",std_drawing:"Entraînez-vous à dessiner les kanji suivants plusieurs fois.",vocab_multi:"Choisissez la définition correcte pour chaque expression japonaise.",vocab_writing:"Entraînez-vous à épeler les mots/expressions suivants.",vocab_fill:"Écrivez la définition japonaise des mots/expressions suivants.",kana_multi:"Choisissez le Romaji correct pour le %{KANA}.",kana_writing:"Entraînez-vous à écrire le %{KANA} suivant.",kana_fill:"Complétez le tableau en remplissant le Romaji.",num_multi:"Lisez le japonais et choisissez les bons chiffres.",num_writing:"Entraînez-vous à épeler les chiffres suivants.",num_fill:"Écrivez les chiffres suivants en japonais (hiragana).",kanji_readings_multi:"Choisissez les lectures correctes pour chaque kanji.",kanji_readings_drag:"Associez chaque kanji à ses lectures.",kanji_yomikata:'</div><p class="text-block" style="margin:10px 0;">▶ indique le <em>on-yomi</em> (prononciation empruntée à l\'origine du chinois).<br>▷ indique le <em>kun-yomi</em> (lecture japonaise native).</p>',kanji_meanings_multi:"Choisissez les significations correctes pour chaque kanji.",kanji_meanings_drag:"Associez chaque kanji à ses significations.",opts:{kana:{kana:"Glisser-Déposer",multi:"Choix Multiple",writing:"Pratique d'Écriture",fill:"Compléter le Tableau"},numbers:{drag:"Glisser-Déposer",multi:"Choix Multiple",writing:"Pratique d'Orthographe",fill:"Écrire les Chiffres"},kanji:{multi:"Choix Multiple",drag:"Glisser-Déposer"},vocab:{drag:"Glisser-Déposer",multi:"Choix Multiple",writing:"Pratique d'Orthographe",fill:"Écrire la Définition"},practice:{multi:"Choix Multiple",fill:"Écrit",drag:"Glisser-Déposer"},hirakata:{fill:"Écrit",stroke:"Pratique de l'Ordre des Traits",drawing:"Pratique de Dessin"}},mistakes:'Les éléments entourés en <span class="t-red t-bold">rouge</span> ont été mal répondus avant de trouver la bonne réponse. Revoyez ces problèmes avant d\'essayer à nouveau.',writing_mistakes:'Les éléments entourés en <span class="t-red t-bold">rouge</span> ont été mal répondus. Revoyez ces problèmes avant d\'essayer à nouveau.',multi_mistakes:'Les réponses que vous avez sélectionnées qui étaient incorrectes sont entourées en <span class="t-red t-bold">rouge</span>. Les réponses correctes sont entourées en <span class="t-blue t-bold">bleu</span>. Revoyez ces problèmes avant d\'essayer à nouveau.',stroke_mistakes:"Les caractères que vous avez dessinés incorrectement sont entourés en <span class=\"t-red t-bold\">rouge</span>. Veuillez revoir l'ordre des traits et le nombre de traits pour ces caractères avant d'essayer à nouveau.<br><br><b>Remarque :</b> Parfois, les réponses peuvent être marquées comme incorrectes par erreur, en raison d'un décalage dans l'algorithme de reconnaissance.<br>Veuillez utiliser votre propre jugement si cela se produit.",fill_mistakes:'Les éléments soulignés en <span class="t-red t-bold">rouge</span> ont été mal répondus, les réponses correctes sont listées en dessous en <span class="t-green t-bold">vert</span>. Revoyez ces problèmes avant d\'essayer à nouveau.',sub_answers:'<b>Remarque :</b> Les réponses entre parenthèses <span class="t-blue t-bold">bleues</span> séparées par "<span class="alt-phrase-sep">/</span>" sont une liste de sous-réponses possibles ; une seule peut être utilisée.<br>Par exemple.. <span class="t-green"><span class="alt-phrase">(</span>あの<span class="alt-phrase-sep">/</span>その<span class="alt-phrase">)</span>ねこ</span> : そのねこ ou あのねこ <span class="t-green">(bon)</span> contre あの/そのねこ <span class="t-red">(mauvais)</span><br><span class="t-green"><span class="alt-phrase">(</span>この<span class="alt-phrase-sep">/</span><span class="alt-phrase">)</span>ねこ</span> signifie que la sous-réponse est optionnelle ; elle peut être omise.',review:'<div id="review-exercise" class="center clearfix"><button id="review-button" class="button" onclick="Genki.review();"><i class="fa">&#xf02d;</i>Réviser</button></div>',toggle_furigana:'<button id="toggle-furigana" class="button" onclick="Genki.toggle.furigana(this);"><i class="fa">&#xf2a8;</i>'+(storageOK&&"false"==localStorage.furiganaVisible?"Afficher":"Masquer")+" les Furigana</button>",check_answers:'<div id="check-answers" class="center"><button id="check-answers-button" class="button" onclick="Genki.check.answers();"><i class="fa">&#xf00c;"></i>Vérifier les Réponses</button></div>',back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;"></i>Retour au Dictionnaire</button>'},active:{type:null,exercise:null,index:0,path:e.location.pathname.replace(/.*?\/lessons.*?\/(.*?\/.*?)\/.*/g,"$1")},exercises:e.GenkiExercises||null,scrollTo:function(e,i){"string"==typeof e&&(e=t.querySelector(e));var a=function(){t.body.scrollTop=e.offsetTop,t.documentElement.scrollTop=e.offsetTop};i?setTimeout(a,100):a()},QuizType:{DRAG:"drag",KANA:"kana",WRITING:"writing",MULTI:"multi",FILL:"fill",STROKE:"stroke",DRAWING:"drawing"},generateQuiz:function(a){!i.exerciseData&&e.JSON&&(i.exerciseData=JSON.stringify(a));var s=t.getElementById("quiz-zone");if("object"==typeof a.type){for(var n,r=!!/(?:begin|start)=\d/.test(e.location.search)&&e.location.search.replace(/.*?(?:begin|start)=(\d).*/,"$1"),o=0,l=a.type.length,c="";o<l;o++)c+='<option value="'+o+'"'+(!1!==r?o==r?" selected":"":storageOK&&localStorage["genki_pref_"+a.format]==a.type[o]?" selected":"")+">"+i.lang.opts[a.format][a.type[o]]+"</option>";return n=GenkiModal.open({title:"Veuillez sélectionner un type d'exercice",content:'Veuillez sélectionner le type d\'exercice que vous souhaitez faire, puis cliquez sur "Commencer" pour commencer à étudier.<br><br><div class="center">'+(/\/dictionary\/|\/custom-vocab\//.test(e.location)?"":"<div><b>Exercice en cours</b><br>"+t.title.replace(/ \| Genki Study Resources.*$/,"")+"</div><br>")+'<div><b>Type d\'exercice</b><br><select id="exercise-type">'+c+'</select></div><br><div title="The exercise type can still be changed via the Change Exercise Type button at the bottom of an exercise."><input id="modal-skip-ex-type" class="genki_input_hidden" type="checkbox"'+(storageOK&&"true"==localStorage.genkiSkipExType?" checked":"")+' onchange="localStorage.genkiSkipExType = this.checked"><span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click();" onkeypress="event.key == \'Enter\' && this.previousSibling.click();"></span><label class="checkbox-label" for="modal-skip-ex-type">Sauter la sélection du type d\'exercice</label></div></div>',buttonText:"Commencer",noClose:1,zIndex:"low",callback:function(){var e=t.getElementById("exercise-type").value;if(a.type=a.type[e],a.info="object"==typeof a.info&&a.info[e]?a.info[e]:a.info,storageOK&&(localStorage["genki_pref_"+a.format]=a.type),/vocab|kana|numbers|kanji/.test(a.format)){if("kana"==a.format&&"kana"!=a.type){var s={};for(q in a.quizlet)for(d in a.quizlet[q])s[d]=a.quizlet[q][d];a.quizlet=s,a.info=a.info.replace("%{KANA}",i.active.exercise[1].replace(/.*?(Hiragana|Katakana).*/,"$1"))}if("kanji"==a.format){if(a.readings){for(q in a.quizlet){var n=a.quizlet[q].split("|");a.quizlet[q]=(n[0]?'<span class="yomikata" title="on-yomi">▶</span>'+n[0]+"<br>":"")+(n[1]?'<span class="yomikata" title="kun-yomi">▷</span>'+n[1]:"")}a.info+=i.lang.kanji_yomikata}"drag"==a.type&&(t.getElementById("exercise").className+=a.readings?" kanji-readings":a.meanings?" kanji-meanings":"")}if("multi"==a.type){var r,o,l,c,d,u,p=[],g=[],m=[];for(q in a.quizlet)g.push(q),m.push(q);for(q=0,w=g.length;q<w;q++){for(y=g[z=Math.floor(Math.random()*g.length)].split("|"),r=a.quizlet[g[z]].replace(/\|.*?$/,""),o=/\|/.test(a.quizlet[g[z]])?a.quizlet[g[z]].replace(/.*?\|(.*?$)/,"$1"):"",p.push({question:'<div class="multi-vocab">'+(y[1]?"<ruby>":"kanji"==a.format?'<div class="big-kanji">':"")+y[0]+(y[1]?"<rt>"+y[1]+"</rt></ruby>":"kanji"==a.format?"</div>":"")+(o?'<hr><div class="multi-vocab-sentence">'+o+"</div>":"")+"</div>",answers:["A"+r]}),(c=m.slice()).splice(z,1),d=3;d-- >0&&c.length;)u=Math.floor(Math.random()*c.length),(l=a.quizlet[c[u]].replace(/\|.*?$/,""))==r?d++:p[q].answers.push("A"==l.charAt(0)?"!"+l:l),c.splice(u,1);g.splice(z,1)}a.quizlet=p}else if("writing"==a.type){var h;p={};for(q in a.quizlet)for(var k,v=(h=q.split("|"))[0].split("／"),f=0,b=v.length;f<b;f++)k=h[1]?h[1]:"kana"==a.format?a.quizlet[q]:"",p[v[f].replace(/\(.*?\)|（.*?）|～/g,"")]=k,/\(.*?\)|（.*?）/.test(v[f])&&(p[v[f].replace(/～|\(|\)|（|）/g,"")]=k);a.quizlet=p,a.columns=6}else if("fill"==a.type)if(/vocab|numbers/.test(a.format)){var y,x,q,w,z;p='<div class="count-problems columns-2 clear"><div>',g=[];for(q in a.quizlet)g.push(q);for(q=0,w=g.length,z=Math.ceil(w/2);q<w;q++)x=("{"+(y=g[q].split("|"))[0].replace(/。|～/g,"")+(y[1]?"|"+y[1].replace(/。|～/g,""):"")+(/。|～/g.test(y[0])?"|"+y[0]:"")+(y[1]&&/。|～/g.test(y[1])?"|"+y[1]:"")+"}").replace(/\((.*?)\)/g,"%($1/)").replace(/（(.*?)）/g,"%($1/)").replace(/／/g,"|"),p+=(q==z?"</div><div>":"")+'<div class="problem">'+a.quizlet[g[q]].replace(/\|.*?$/,"")+"<br>"+(/\|/.test(x)?x.replace("}","|answer}"):x)+"</div>";a.quizlet=p+"</div></div>"}else"kana"==a.format&&(a.quizlet=a.chart)}else if("practice"==a.format){a.quizlet=a.quizlet[e];var T=t.querySelector(".multi-quiz-image");"fill"==a.type&&T?T.style.display="none":"multi"==a.type&&T&&(T.style.display="")}else"hirakata"==a.format&&(a.quizlet=a.quizlet[e]?a.quizlet[e]:a.quizlet[a.quizlet.length-1]);i.generateQuiz(a),i.changingExType=!1}}),!i.changingExType&&(!1!==r||storageOK&&"true"==localStorage.genkiSkipExType)&&(n.callback(),GenkiModal.close()),i.create.exerciseTypeButton(),!1}if(i.active.type=a.type,/\!GRI/.test(a.info)&&(a.info=a.info.replace(/\{.*?\}/g,(function(e){var t=e.slice(1,e.length-1).split("|");return'<a href="'+getPaths()+"lessons-3rd/appendix/grammar-index/"+i.local+"#"+t[2]+'" target="_blank"'+(i.local&&!i.debug?"":" onclick=\"Genki.getGrammarPoint(this, '"+t[2]+"'); return false;\"")+">"+t[1]+"</a>"}))),"drag"==a.type){var d,u,p='<div id="quiz-info">'+a.info+'</div><div id="question-list">',g='<div id="drop-list">',m=[];for(o in a.quizlet)m.push(o);for(d=m.slice(0);m.length;)o=Math.floor(Math.random()*m.length),p+='<div class="quiz-item-group"><div class="quiz-item" '+((x=/\|/.test(m[o])?'data-helper="'+m[o].split("|").pop()+'"':null)||"")+">"+(x?m[o].replace(/(.*?)\|(.*)/,'$1<span class="hidden-text">$2</span>'):m[o])+"</div></div>",g+='<div tabindex="0" class="quiz-answer-zone'+(/\|/.test(m[o])?" helper-answer":"")+'" data-text="'+m[o].replace(/\|.*?$/,"")+'" data-mistakes="0"></div>',m.splice(o,1),++i.stats.problems,!u&&x&&(u=!0);for(p+="</div>"+g+"</div>",u&&(s.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),p+='<div id="answer-list">';d.length;)p+='<div tabindex="0" class="quiz-item" data-answer="'+d[o=Math.floor(Math.random()*d.length)].replace(/\|.*?$/,"")+'"><div class="quiz-item-text">'+a.quizlet[d[o]].replace(/\|.*?$/,"")+"</div></div>",d.splice(o,1);p+="</div>",s.innerHTML=p+i.lang.review.replace("</div>",i.lang.toggle_furigana+'<button id="toggle-orientation" class="button" onclick="Genki.toggle.vocabOrientation(this);"><i class="fa" style="position:relative;transform:rotate(90deg);">&#xf0db;</i>Horizontal Mode</button></div>'),storageOK&&"true"==localStorage.vocabHorizontal&&i.toggle.vocabOrientation(t.getElementById("toggle-orientation"),"false")}else if("kana"==a.type){p='<div id="quiz-info">'+a.info+'</div><div id="question-list" class="clear">';var h,k='<div id="answer-list">',v=[],f=a.quizlet;for(o=f.length-1;o>-1;o--){for(h in p+='<div class="quiz-column">',f[o])p+='<div class="quiz-item-row"><div tabindex="0" class="quiz-answer-zone" data-text="'+f[o][h]+'" data-mistakes="0"></div><div class="quiz-item">'+f[o][h]+"</div></div>",v.push('<div tabindex="0" class="quiz-item" data-answer="'+f[o][h]+'">'+h+"</div>"),++i.stats.problems;p+="</div>"}for(;v.length;)k+=v[o=Math.floor(Math.random()*v.length)],v.splice(o,1);s.innerHTML=p+"</div>"+k+"</div>"+i.lang.review}else if("writing"==a.type){p='<div id="quiz-info">'+a.info+"<br>Si vous ne savez pas comment taper en japonais sur votre ordinateur, veuillez visiter notre page d'aide en <a href=\"../../../help/writing/"+i.local+'" target="_blank">cliquant ici</a>.</div><div id="question-list">';var b='style="width:'+100/((E=a.columns)+1)+'%;"',y=0,x=!1;for(o in a.quizlet){for(p+='<div class="quiz-answer-row'+(a.quizlet[o]?" furi-row":"")+'"><div class="quiz-item" data-helper="'+a.quizlet[o]+'" '+b+'><div class="quiz-item-text">'+o+"</div></div>",l=0;E-- >0;)p+='<div class="writing-zone" '+b+'><input class="writing-zone-input" type="text" '+(!a.quiz&&l++<3?'placeholder="'+o+'"':"")+' data-answer="'+(a.quiz?a.quizlet[o]:o)+'" data-mistakes="0" tabindex="0" '+(a.quiz?"":'oninput="Genki.check.value(this);"')+' onfocus="Genki.input.index = '+y+++'"></div>',++i.stats.problems;p+="</div>",E=a.columns}/data-helper/.test(p)&&(x=!0,s.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),s.innerHTML=p+"</div>"+i.lang.check_answers.replace("</div>",x?i.lang.toggle_furigana+"</div>":"</div>"),a.quiz&&(s.className+=" no-helper"),i.input={map:t.querySelectorAll(".writing-zone-input"),index:0},i.input.map[0].autofocus=!0}else if("multi"==a.type){p='<div id="quiz-info">'+a.info+'</div><div id="question-list">',k='<div id="answer-list">';var q=65,w=!1,z=(x=!1,/"format":"vocab"/.test(i.exerciseData));for(o=0,l=(M=a.quizlet).length;o<l;o++){if(p+='<div id="quiz-q'+o+'" class="question-block" data-qid="'+(o+1)+'" style="display:none;"><div class="quiz-multi-question">'+(a.questionsAlignLeft?'<div class="quiz-question-inner-text">':"")+(void 0!==M[o].question?M[o].question.replace(/\{.*?\}/g,(function(e){var t=e.slice(1,e.length-1).split("|");if("!IMG"==t[0])return i.parse.image(t)})):'<div class="text-passage'+(M[o].vertical?" vertical-text":"")+'" '+(M[o].text.replace(/<br>/g,"").length<50?'style="text-align:center;"':"")+">"+M[o].text+"</div>"+(M[o].helper||""))+(a.questionsAlignLeft?"</div>":"")+"</div>"+(z?'<button class="button vocab-spoiler-toggle" onclick="Genki.toggle.vocabSpoiler(this);"><i class="fa"></i>Show Choices</button><div class="vocab-spoiler">':""),M[o].text)p+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, true);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, true);">NEXT</div></div>',++i.stats.exclude;else for(;M[o].answers.length;)I=Math.floor(Math.random()*M[o].answers.length),/^A|^\!/.test(M[o].answers[I])&&("A"==M[o].answers[I].charAt(0)&&(w=!0),M[o].answers[I]=M[o].answers[I].slice(1)),p+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer" data-answer="'+w+'" data-option="'+String.fromCharCode(q++)+'" onclick="Genki.progressQuiz(this);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this);"><div class="quiz-answer-inner-text">'+M[o].answers[I]+"</div></div></div>",w=!1,M[o].answers.splice(I,1);p+=(z?"</div>":"")+"</div>",q=65,++i.stats.problems}/class="furigana"|class="inline-furi"|<ruby>/.test(p)&&(x=!0,s.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),z&&storageOK&&"true"==localStorage.spoilerMode&&(s.className+=" spoiler-mode"),s.innerHTML=p+'</div><div id="next-button" class="quiz-multi-row" style="margin-top:-20px; visibility:hidden;'+("classic"==i.feedbackMode?"display:none;":"")+'"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.showNextQuestion(this);" onkeypress="event.key == \'Enter\' && Genki.showNextQuestion(this);">NEXT</div></div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix">'+(i.appendix?"":'<button class="button text-selection-mode-button" onclick="Genki.toggle.textSelection(this);"><i class="fa">&#xf246;</i> Enable Text Selection</button>')+(x?i.lang.toggle_furigana:"")+"</div>",i.progressQuiz("init")}else if("fill"==a.type){x=!1;/class="furigana"|class="inline-furi"|<ruby>/.test(a.quizlet)&&(x=!0,s.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),s.innerHTML='<div id="quiz-info">'+a.info+"<br>If you don't know how to type in Japanese on your computer, please visit our help page by <a href=\"../../../help/writing/"+i.local+'" target="_blank">clicking here</a>.</div><div class="text-block">'+a.quizlet.replace(/\{.*?\}/g,(function(e){var t,a,s,n,r,o=e.slice(1,e.length-1).split("|");return"!IMG"==o[0]?i.parse.image(o):"!GRI"==o[0]?'<a href="'+getPaths()+"lessons-3rd/appendix/grammar-index/"+i.local+"#"+o[2]+'" target="_blank"'+(i.local&&!i.debug?"":" onclick=\"Genki.getGrammarPoint(this, '"+o[2]+"'); return false;\"")+">"+o[1]+"</a>":"!AUDIO"==o[0]?'<div class="audio-block center"><audio id="'+o[1]+'" controls><source src="'+getPaths()+"resources/audio/"+("lessons-3rd"==i.ed?"3rd-edition/":"2nd-edition/")+o[1]+'.mp3" type="audio/mpeg"></audio></div>':"!PLAY"==o[0]?'<button class="button play-button" onclick="Genki.playAudio(\''+o[1]+"', "+o[2]+');"><i class="fa">&#xf04b;</i></button>':(t=o[1]?o[1]:"",a=(o[10]||o[9]||o[8]||o[7]||o[6]||o[5]||o[4]||o[3]||o[2]?o[10]||o[9]||o[8]||o[7]||o[6]||o[5]||o[4]||o[3]||o[2]:"").split(";"),(/\%\((.*?)\)/.test(t)||/\%\((.*?)\)/.test(o[0]))&&(s=[o[0].match(/%\((.*?)\)/),t.match(/%\((.*?)\)/)]),++i.stats.problems,n=/width:/.test(a[0])?a[0].split(":")[1]:a[1]&&/width:/.test(a[1])?a[1].split(":")[1]:a[2]&&/width:/.test(a[2])?a[2].split(":")[1]:s?(t?(s[0]&&s[0][1]||"/").split("/").concat((s[1]&&s[1][1]||"/").split("/")):(s[0]&&s[0][1]||"/").split("/")).sort((function(e,t){return t.length-e.length}))[0].length*(14/(/[a-z]/i.test(t||o[0])&&!/[\u3000-\u30FF]/.test(t||o[0])?2:1))+14+[t.replace(/\%\((.*?)\)/g,""),o[0].replace(/\%\((.*?)\)/g,"")].sort((function(e,t){return t.length-e.length}))[0].length*(14/(/[a-z]/i.test(t||o[0])&&!/[\u3000-\u30FF]/.test(t||o[0])?2:1)):[t,o[0]].sort((function(e,t){return t.length-e.length}))[0].length*(14/(/[a-z]/i.test(t||o[0])&&!/[\u3000-\u30FF]/.test(t||o[0])?2:1))+14,r=/placeholder:/.test(a[0])?a[0].split(":")[1]:a[1]&&/placeholder:/.test(a[1])?a[1].split(":")[1]:a[2]&&/placeholder:/.test(a[2])?a[2].split(":")[1]:null,'<span class="writing-zone"><input class="writing-zone-input" type="text" data-answer="'+o[0]+'" '+("answer"==a[0]?'data-answer2="'+t+'" ':"")+("answer"==a[0]&&o[3]?'data-answer3="'+o[2]+'" ':"")+("answer"==a[0]&&o[4]?'data-answer4="'+o[3]+'" ':"")+("answer"==a[0]&&o[5]?'data-answer5="'+o[4]+'" ':"")+("answer"==a[0]&&o[6]?'data-answer6="'+o[5]+'" ':"")+("answer"==a[0]&&o[7]?'data-answer7="'+o[6]+'" ':"")+("answer"==a[0]&&o[8]?'data-answer8="'+o[7]+'" ':"")+("answer"==a[0]&&o[9]?'data-answer9="'+o[8]+'" ':"")+("answer"==a[0]&&o[10]?'data-answer10="'+o[9]+'" ':"")+("furigana"==a[0]?'data-furigana="'+t+'" ':"")+("placeholder"==a[0]||r?'placeholder="'+(r||t)+'" ':"")+'data-mistakes="0" tabindex="0" data-default-width="'+n+'" style="width:'+n*(storageOK&&localStorage.genkiFontSize?+localStorage.genkiFontSize/100:1)+'px;">'+(t&&!/answer|furigana|placeholder/.test(a[0])||a[1]&&/hint:/.test(a[1])||a[2]&&/hint:/.test(a[2])?'<span class="problem-hint">'+(a[1]&&/hint:/.test(a[1])?a[1].split(":")[1]:a[2]&&/hint:/.test(a[2])?a[2].split(":")[1]:t)+"</span>":"")+"</span>")}))+"</div>"+i.lang.check_answers.replace("()","(false, 'fill')").replace("</div>",x?i.lang.toggle_furigana+"</div>":"</div>"),t.querySelector(".writing-zone-input").autofocus=!0}else if("stroke"==a.type){p='<div id="quiz-info">'+a.info+'</div><div id="question-list">',k='<div id="answer-list">';var T,S=storageOK&&"false"==localStorage.strokeOrderVisible,N=storageOK&&"false"==localStorage.tracingGuideVisible;for(o=0,l=(M=a.quizlet).length;o<l;o++)M[o].kana&&(M[o].kanji=M[o].kana),a.kanaType&&(a.kanaType=a.kanaType.charAt(0).toUpperCase()+a.kanaType.slice(1).toLowerCase()),T=getPaths()+"resources/images/stroke-order/"+M[o].order+".png",p+='<div id="quiz-q'+o+'" class="question-block" data-qid="'+(o+1)+'" style="display:none;"><div class="quiz-multi-question"><div class="kanji-container big-kanji'+(M[o].kana?" kana-font":"")+'"'+(M[o].font?' style="font-family:'+M[o].font+'"':"")+">"+M[o].kanji+'</div><div class="kanji-stroke-order"><a class="button-link" href="'+(M[o].kana?getPaths()+"resources/images/stroke-order/sasagami-"+a.kanaType.toLowerCase()+".jpg":"https://jisho.org/search/"+M[o].kanji+"%20%23kanji")+'" target="_blank" title="View stroke order '+(M[o].kana?"chart":"on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+T+'" target="_blank" title="Click to view image"><img src="'+T+'" alt="stroke order"/></a></div></div><div class="quiz-multi-row"><canvas class="kanji-canvas" data-kanji="'+M[o].kanji+'" data-strokes="'+M[o].strokes+'" data-guide="'+!N+'"'+(M[o].kana&&!M[o].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':M[o].font?' data-font="'+M[o].font+'"':"")+' id="canvas-'+o+'" width="200" height="200"'+(M[o].kana?'data-kana="true"':"")+'></canvas></div><div class="kanji-canvas-actions quiz-multi-row center"><button class="button" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+o+'" title="(CTRL+X)"><i class="fa">&#xf12d;</i>Erase</button><button class="button" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+o+'" title="(CTRL+Z)"><i class="fa">&#xf0e2;</i>Undo</button>'+(i.debug?'<button class="button" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+o+'" title="Open console (F12) to see recognition candidates (CTRL+F)"><i class="fa">&#xf188;</i>Test Recognition</button>':"")+'</div><div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, false, \'stroke\');" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, false, \'stroke\');" data-canvas="canvas-'+o+'">Next '+(M[o].kana?a.kanaType:"Kanji")+"</div></div></div>",++i.stats.problems;s.innerHTML=p+'</div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix"><button id="toggle-stroke-order" class="button" onclick="Genki.toggle.strokeOrder(this);"><i class="fa">&#xf1fc;</i>'+(S?"Show":"Hide")+' Stroke Order</button><button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this);"><i class="fa">&#xf031;</i>'+(N?"Show":"Hide")+' Tracing Guide</button><button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button></div>',S&&(s.className+=" stroke-order-hidden"),i.progressQuiz("init",!1,"stroke")}else if("drawing"==a.type){p='<div id="quiz-info">'+a.info+'</div><div id="question-list">',N=storageOK&&"false"==localStorage.tracingGuideVisible,b='style="width:'+100/((E=a.columns)+1)+'%;"';var E,M=a.quizlet,I=0;for(o=0,l=a.quizlet.length;o<l;o++){for(M[o].kana&&(M[o].kanji=M[o].kana),p+='<div class="quiz-answer-row"><div class="drawing-zone" '+b+'><div class="quiz-item"><div class="quiz-item-text'+(M[o].kana?" kana-font":"")+'"'+(M[o].font?' style="font-family:'+M[o].font+'"':"")+">"+M[o].kanji+'</div></div><button class="button stroke-order-button" onclick="Genki.viewStrokeOrder(\''+M[o].kanji+"', '"+M[o].order+"'"+(M[o].kana?",'"+a.kanaType+"'":"")+');">Stroke Order</button></div>';E-- >0;)p+='<div class="drawing-zone" '+b+'><canvas class="kanji-canvas" data-kanji="'+M[o].kanji+'" data-guide="'+(!(a.columns-E>3)&&!N)+'"'+(M[o].kana&&!M[o].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':M[o].font?' data-font="'+M[o].font+'"':"")+' data-strokes="'+M[o].strokes+'" data-size="100" id="canvas-'+I+'" width="110" height="110"'+(M[o].kana?'data-kana="true"':"")+'></canvas><div class="kanji-canvas-actions"><button class="button icon-only" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+I+'" title="Erase (CTRL+X)"><i class="fa">&#xf12d;</i></button><button class="button icon-only" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+I+'" title="Undo (CTRL+Z)"><i class="fa">&#xf0e2;</i></button>'+(i.debug?'<button class="button icon-only" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+I+'" title="Test Recognition (CTRL+F)"><i class="fa">&#xf188;</i></button>':"")+"</div></div>",++i.stats.problems,++I;p+="</div>",E=a.columns}s.innerHTML=p+"</div>"+i.lang.check_answers.replace("()","(false, 'drawing')").replace("</div>",'<button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this, true);"><i class="fa">&#xf031;</i>'+(N?"Show":"Hide")+' Tracing Guide</button><button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button></div>');var j=t.querySelectorAll(".kanji-canvas");for(o=0,l=j.length;o<l;o++)KanjiCanvas.init(j[o].id)}if(i.currentAnswers){if(a.type==i.currentAnswers.type)for(o=0,l=(H=t.querySelectorAll(".writing-zone-input")).length;o<l;o++)H[o].value=i.currentAnswers.list[o];delete i.currentAnswers}if("drag"==a.type||"kana"==a.type){var L=dragula([t.querySelector("#answer-list")],{isContainer:function(e){return e.classList.contains("quiz-answer-zone")}});L.on("drag",(function(e){i.isTouch&&i.isTouching&&"hidden"!=t.body.style.overflow&&(t.body.style.overflow="hidden"),i.markedItem&&(i.markedItem.className=i.markedItem.className.replace(" markedItem",""),i.markedItem=null),i.markedItem=e,e.className+=" markedItem"})),i.isTouch&&L.on("cancel",(function(){t.body.style.overflow=""})),L.on("drop",(function(e,a,s){i.isTouch&&(t.body.style.overflow=""),a.dataset.text&&(e.dataset.answer!=a.dataset.text?(t.getElementById("answer-list").appendChild(e),a.dataset.mistakes=++a.dataset.mistakes,a.dataset.mistakes>1?i.stats.mistakes:++i.stats.mistakes):(a.className+=" answer-correct",i.markedItem&&(i.markedItem.className="quiz-item",i.markedItem=null),++i.stats.solved==i.stats.problems&&i.endQuiz()))})),i.drake=L,i.globalEventListenersSet||(i.globalEventListenersSet=!0,["click","keypress"].forEach((function(e){t.addEventListener(e,(function(e){if(!("keypress"==e.type&&"Enter"!=e.key||i.quizOver)){for(var a=e.target,s=4,n=s-1;s-- >0&&(s<n&&(a=a.parentNode?a.parentNode:a),!/quiz-item$|quiz-answer-zone/.test(a.className)););/quiz-item/.test(a.className)&&"answer-list"==a.parentNode.id?(i.markedItem&&(i.markedItem.className=i.markedItem.className.replace(" markedItem","")),i.markedItem=a,i.markedItem.className+=" markedItem"):i.markedItem&&/quiz-answer-zone/.test(a.className)?i.markedItem.dataset.answer!=a.dataset.text?(i.wrongTimeout&&(t.getElementById("wrongAnswer").id="",clearTimeout(i.wrongTimeout),delete i.wrongTimeout),a.id="wrongAnswer",i.wrongTimeout=setTimeout((function(){t.getElementById("wrongAnswer").id="",delete i.wrongTimeout}),1e3),a.dataset.mistakes=++a.dataset.mistakes,++i.stats.mistakes):(a.className+=" answer-correct",a.appendChild(i.markedItem),a.tabIndex=-1,a.firstChild.tabIndex=-1,i.markedItem.className=i.markedItem.className.replace(" markedItem",""),i.markedItem=null,++i.stats.solved==i.stats.problems&&i.endQuiz()):i.markedItem&&(i.markedItem.className=i.markedItem.className.replace(" markedItem",""),i.markedItem=null),"click"==e.type&&/quiz-answer-zone/.test(e.target.className)&&e.target.blur()}}))})))}var C=new Timer,G=t.getElementById("quiz-timer");if(G.innerHTML="00:00:00",C.start(),C.addEventListener("secondsUpdated",(function(e){G.innerHTML=C.getTimeValues().toString()})),i.timer=C,storageOK&&"false"!=localStorage.timerAutoPause&&t.addEventListener("visibilitychange",i.startOrPauseTimerByVisibility),t.getElementById("exercise").className+=" content-loaded "+("stroke"==a.type?"stroke-quiz multi":a.type)+"-quiz",i.scrollTo("#exercise-title",!0),(i.debug||!/drag|kana|drawing/.test(a.type)&&!i.appendix)&&(i.debug||a.format&&!/vocab|kana|numbers/.test(a.format)||!a.format)&&i.quickJisho.create(),"fill"==a.type||"writing"==a.type){var B=t.querySelector("[autofocus]");B&&B!=t.activeElement&&(B.focus(),i.debug&&console.warn("autofocus failed: HTMLElement.focus() will be used as a fallback."))}"multi"==a.type&&((M=t.querySelector(t.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer"))&&M.focus());var H;for(o=0,l=(H=t.querySelectorAll("AUDIO")).length;o<l;o++)H[o].onplay=function(){for(var e=t.querySelectorAll("AUDIO"),i=0,a=e.length;i<a;i++)e[i]==this||e[i].paused||e[i].pause()},i.debug&&(H[o].ontimeupdate=function(){console.log(this.id,this.currentTime)})},incrementProgressBar:function(){var e=t.getElementById("quiz-progress-bar"),a=Math.floor((i.stats.solved+1)/i.stats.problems*100);e.style.width=a+"%",e.innerHTML='<span id="quiz-progress-text">'+(i.stats.solved+1)+"/"+i.stats.problems+"</span>"},progressQuiz:function(e,a,s){if(i.textSelectMode||i.quizOver)return!1;if("init"==e)t.getElementById("quiz-q"+i.stats.solved).style.display="",i.incrementProgressBar();else{if(e&&"stroke"==s){var n=KanjiCanvas.recognize(e.dataset.canvas);e=e.parentNode.parentNode.querySelector(".kanji-canvas"),i.debug&&console.log("toDraw: "+e.dataset.kanji),i.debug&&console.log("Results: "+n),i.debug&&console.log("Correct: "+(new RegExp(e.dataset.kanji).test(n)&&e.dataset.strokesAnswer==e.dataset.strokes).toString()),e.dataset.answer=new RegExp(e.dataset.kanji).test(n)&&e.dataset.strokesAnswer==e.dataset.strokes}e.className+=" selected-answer",a&&(e.parentNode.className+=" hidden-answer"),"false"==e.dataset.answer&&(e.parentNode.parentNode.className+=" wrong-answer",++i.stats.mistakes);var r=t.getElementById("quiz-q"+i.stats.solved++),o=t.getElementById("quiz-q"+i.stats.solved);if(o){if("instant"==i.feedbackMode&&"multi"==i.active.type)i.multiNodes||(i.multiNodes={list:t.getElementById("question-list"),button:t.getElementById("next-button"),next:null,last:null}),i.quizOver=!0,i.multiNodes.list.className+=" multi-quiz quiz-over",i.multiNodes.button.style.visibility="visible",i.multiNodes.button.firstChild.focus(),i.multiNodes.next=o,i.multiNodes.last=r;else o.style.display="",r.style.display="none",(l=o.querySelector(t.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer"))&&l.focus(),i.incrementProgressBar()}else{i.endQuiz(s==i.QuizType.STROKE?s:i.QuizType.MULTI);for(var l,c=0,d=(l=t.querySelectorAll('[id^="quiz-q"]')).length;c<d;c++)l[c].style.display="";t.getElementById("quiz-progress").style.display="none"}}"stroke"==s&&t.getElementById("canvas-"+i.stats.solved)&&KanjiCanvas.init("canvas-"+i.stats.solved)},showNextQuestion:function(e){i.multiNodes.next.style.display="",i.multiNodes.last.style.display="none",i.quizOver=!1,i.multiNodes.list.className=i.multiNodes.list.className.replace(" multi-quiz quiz-over",""),i.multiNodes.button.style.visibility="hidden";var a=i.multiNodes.next.querySelector(t.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer");a&&a.focus(),i.incrementProgressBar()},endQuiz:function(a){i.quizOver=!0,a="drawing"==a?"stroke":a;var s=i.stats.solved-i.stats.exclude,n=i.stats.problems-i.stats.exclude;i.stats.score=Math.floor(100*(s-i.stats.mistakes)/n),i.timer.stop();var r=t.getElementById("quiz-timer");if(r.style.display="none",t.getElementById("quiz-result").innerHTML='<div id="complete-banner" class="center">Quiz Complete!</div><div id="result-list"><div class="result-row"><span class="result-label">Problems Solved:</span>'+n+'</div><div class="result-row"><span class="result-label">Answers Wrong:</span>'+i.stats.mistakes+'</div><div class="result-row"><span class="result-label">Score:</span>'+i.stats.score+'%</div><div class="result-row"><span class="result-label">Completion Time:</span>'+r.innerHTML+'</div><div class="result-row center">'+(100==i.stats.score?"PERFECT! Great Job, you have mastered this quiz! Feel free to move on or challenge yourself by trying to beat your completion time.":i.stats.score>70?"Nice work! "+i.lang[a?a+"_mistakes":"mistakes"]:"Keep studying! "+i.lang[a?a+"_mistakes":"mistakes"])+(t.querySelector(".alt-phrase")?"<br><br>"+i.lang.sub_answers:"")+'<div class="center">'+(/\/dictionary\//.test(e.location)?i.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Try Again</button>')+'<button class="button" onclick="Genki.breakTime();"><i class="fa">&#xf0f4;</i>Take a Break</button><a href="'+t.getElementById("home-link").href+'" class="button"><i class="fa">&#xf015;</i>Back to Index</a></div></div></div>',storageOK&&i.active.exercise.length>0&&!/appendix|study-tools/.test(i.active.exercise[0])){var o=i.active.exercise[0],l=localStorage.GenkiEdition,c=JSON.parse(localStorage.Results);c[l]||(c[l]={});var d=c[l];d[o]=void 0===d[o]||i.stats.score>d[o]?i.stats.score:d[o],localStorage.Results=JSON.stringify(c),i.create.removeExerciseList(),i.create.exerciseList(),"true"!=localStorage.dataBackupReminder&&null!=localStorage.dataBackupReminder||(++i.dataBackupReminderCount>=10&&(i.dataBackupReminderCount=0,setTimeout((function(){GenkiModal.open({title:"Backup Exercise Score Data?",content:'You\'ve recently completed 10 exercises. Would you like to backup your exercise score data?<br><br><div class="center"><a id="save-exercise-data" class="button" download="Genki Exercise Score Data" href="data:,'+(storageOK&&localStorage.Results?encodeURIComponent(localStorage.Results.replace(/\n/g,"\r\n")):"")+'"><i class="fa">&#xf019;</i>Save Data</a><br><br><div title="Stops this popup from showing every 10 exercises.\nYou can re-enable the data backup reminder via the settings manager."><input id="modal-data-backup-reminder" class="genki_input_hidden" type="checkbox" onchange="localStorage.dataBackupReminder = this.checked == true ? false : true;"><span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click();" onkeypress="event.key == \'Enter\' && this.previousSibling.click();"></span><label class="checkbox-label" for="modal-data-backup-reminder">Disable Data Backup Reminders</label><br><br><div class="donate-box clear"><div class="donate-icon"><i class="fa">&#xf004;</i></div><div class="donate-text">If Genki Study Resources has helped you with your studies, please also consider <a href="'+getPaths()+"donate/"+i.local+'" target="_blank">making a donation <i class="fa">&#xf08e;</i></a> if you can, to help support the continued development and maintenance of these resources. Your support is greatly appreciated!</div></div></div></div>',zIndex:"low",focus:"#save-exercise-data"})}),100)),localStorage.dataBackupReminderCount=i.dataBackupReminderCount)}"stroke"==a&&(t.getElementById("toggle-stroke-numbers").style.display="",t.getElementById("toggle-tracing-guide").style.display="none"),i.drake&&setTimeout((function(){i.drake.destroy(),delete i.drake}),100);var u=t.getElementById("change-exercise-type-container");u&&(u.style.display="none"),t.getElementById("exercise").className+=" quiz-over",i.scrollTo("#complete-banner",!0)},reset:function(a){if(e.JSON){if(!a&&/fill-quiz|writing-quiz/.test(t.getElementById("exercise").className)&&i.stats.mistakes>0)return GenkiModal.open({title:"Try again with your current answers?",content:"<div>Would you like to try again with your current answers? This will allow you to correct the answers you got wrong while preserving what you have already written.</div><br><div>※ Please note that your answers will be lost if you change the page or exercise type.</div>",buttonText:"Yes",closeButtonText:"No",customButton:'<button id="genki-modal-cancel" class="button" onclick="GenkiModal.close();">Cancel</button>',keepOpen:!0,callback:function(){for(var e=[],a=t.querySelectorAll(".writing-zone-input"),s=0,n=a.length;s<n;s++)e.push(a[s].value);i.currentAnswers={type:/fill-quiz/.test(t.getElementById("exercise").className)?"fill":"writing",list:e},GenkiModal.close(),i.reset(!0)},closeCallback:function(){GenkiModal.close(),i.reset(!0)}});i.exerciseComplete=!1,i.quizOver=!1,i.isTouching=!1,i.textSelectMode=!1,i.strokeNumberDisplay=!1,i.markedItem=null,i.stats={problems:0,solved:0,mistakes:0,score:0,exclude:0},i.multiNodes&&delete i.multiNodes,i.timer.isRunning()&&i.timer.stop(),i.quickJisho.cache&&(!i.quickJisho.hidden&&i.quickJisho.toggle(),i.quickJisho.search(""),i.quickJisho.cache.search.value="");var s=t.getElementById("exercise"),n=t.querySelector(".multi-quiz-image");s.className="content-block",s.innerHTML=t.getElementById("exercise-title").outerHTML+'<div id="quiz-result"></div><div id="quiz-zone" class="clear"></div>'+(n?n.outerHTML:"")+'<div id="quiz-timer" class="center"></div>'+t.querySelector(".more-exercises").outerHTML,i.appendix?(s.style.display="none",t.getElementById("appendix-tool").style.display="",i.scrollTo(/\/dictionary\//.test(e.location)?"#practice-words":".title"),/\/dictionary\//.test(e.location)?i.appendix.jisho.launchExercise():/\/map-of-japan\//.test(e.location)?i.appendix.studyMap():/\/numbers-chart\//.test(e.location)?i.appendix.studyChart("numbers"):/\/conjugation-chart\//.test(e.location)&&i.appendix.studyChart("conjugation")):i.tools?(s.style.display="none",t.getElementById("study-tool-editor").style.display="",i.scrollTo(".title")):i.generateQuiz(JSON.parse(i.exerciseData))}else e.location.reload()},breakTime:function(){GenkiModal.open({title:"Take a Break?",content:"Taking a break and waiting before trying again can greatly help with building your memory. 5 to 10 minute breaks are recommended, but you're free to adjust the time to your liking."+(/"format":"vocab"|"type":"drag"/.test(i.exerciseData)?' Please see <a href="'+getPaths()+"help/vocab-memorization/"+i.local+'" target="_blank">this page</a> for more tips on memorizing vocab.':"")+'<br><br><div class="center">Wait <input id="break-minutes" class="center" type="number" value="'+i.breakTimer[i.breakMultiplier]+'" min="1" max="60" onchange="Genki.changeBreakMultiplier(this);"> Minute(s)</div>',buttonText:"Wait",keepOpen:!0,callback:function(){if(i.breakMultiplier<i.breakTimer.length-1){if(2==i.breakMultiplier&&!i.breakTimerCustom){var a=t.getElementById("toggle-furigana");a&&1==/helper-present/.test(t.getElementById("quiz-zone").className)&&a.click()}i.breakMultiplier++}i.local||!i.canNotify||/denied|granted/.test(Notification.permission)||Notification.requestPermission();var s,n=+t.getElementById("break-minutes").value;n>60?n=60:n<=0&&(n=1),GenkiModal.open({title:"Taking a Break",content:'<div id="break-timer" class="center">00:'+(n<10?"0":"")+n+":00</div>",buttonText:"End Break Time",keepOpen:!!(i.appendix||!i.tools&&/"format"/.test(i.exerciseData)),callback:function(){i.reset(),t.body.className=t.body.className.replace(" taking-a-break","")}}),t.body.className+=" taking-a-break",s=Math.floor(10*Math.random())+1,t.getElementById("genki-modal-overlay").style.backgroundImage="url(../../../resources/images/backgrounds/bg-"+(s<10?"0":"")+s+".jpg)";var r=new Timer,o=t.getElementById("break-timer");r.start({startValues:{minutes:n},target:{seconds:0},countdown:!0}),r.addEventListener("secondsUpdated",(function(a){var s=r.getTimeValues().toString();(o.innerHTML=s,"00:00:00"==s)&&(o.innerHTML='Break time is up!<div style="font-size:15px;">Click the button below to resume your studies.</div>',t.getElementById("genki-modal-ok").style.display="inline-block",!i.local&&i.canNotify&&"granted"==Notification.permission&&(new Notification(t.title.replace(/ \| Genki Study Resources.*$/,""),{body:"Break time is up!",icon:t.querySelector('meta[property="og:image"]').content,tag:"breakTime-"+i.active.index}).onclick=function(){e.focus(),this.close()}))}))}})},breakMultiplier:0,breakTimer:[5,10,15,20,30,40,50,60],breakTimerCustom:!1,changeBreakMultiplier:function(e){var t=Number(e.value);t<=5?i.breakMultiplier=0:t<=10?i.breakMultiplier=1:t<=15?i.breakMultiplier=2:t<=20?i.breakMultiplier=3:t<=30?i.breakMultiplier=4:t<=40?i.breakMultiplier=5:t<=50?i.breakMultiplier=6:t<=60&&(i.breakMultiplier=7),i.breakTimerCustom=!0},review:function(){GenkiModal.open({title:"Activate Review Mode?",content:"Are you sure you want to review? Your current progress will be lost.",callback:function(){for(var a=t.querySelectorAll("[data-answer]"),s=0,n=a.length;s<n;s++)t.querySelector('[data-text="'+a[s].dataset.answer+'"]').appendChild(a[s]);i.timer.stop(),i.drake.destroy(),t.getElementById("quiz-timer").style.display="none",t.getElementById("review-exercise").innerHTML=(/\/dictionary\//.test(e.location)?i.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Restart</button>')+(t.querySelector(".drag-quiz")?i.lang.toggle_furigana+t.getElementById("toggle-orientation").outerHTML:""),t.getElementById("quiz-info").innerHTML='You are currently in review mode; go ahead and take your time to study. When you are ready to practice this exercise, click the "restart" button.',t.getElementById("quiz-zone").className+=" review-mode";var r=t.getElementById("change-exercise-type-container");r&&(r.style.display="none")}})},toHalfWidth:function(e){return e.replace(/[\uFF01-\uFF5E]/g,(function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}))},check:{busy:!1,value:function(a){if(i.check.busy||a.value!=a.dataset.answer)i.check.busy&&e.setTimeout((function(){i.check.busy=!1,t.activeElement&&t.activeElement.value&&t.activeElement.value==i.input.map[i.input.index-1].value&&(t.activeElement.value="")}),10);else{i.check.busy=!0;var s=i.input.map[i.input.index+1];s?s.focus():e.setTimeout((function(){a.blur(),i.check.answers(!0),i.check.busy=!1}),10)}},answers:function(e,a){!i.exerciseComplete&&GenkiModal.open({title:"Check Answers?",content:e?"The last input field has been filled in. Are you ready to check your answers?":"Checking your answers will end the quiz. Do you want to continue?",buttonText:"Yes, check my answers!",callback:function(){if(i.exerciseComplete=!0,t.querySelector("#check-answers button").style.display="none",a&&"drawing"==a)for(var e,s=0,n=(d=t.querySelectorAll(".kanji-canvas")).length;s<n;s++)e=KanjiCanvas.recognize(d[s].id),i.debug&&console.log("toDraw: "+d[s].dataset.kanji),i.debug&&console.log("Results: "+e),i.debug&&console.log("Correct: "+(new RegExp(d[s].dataset.kanji).test(e)&&d[s].dataset.strokesAnswer==d[s].dataset.strokes).toString()),new RegExp(d[s].dataset.kanji).test(e)&&d[s].dataset.strokesAnswer==d[s].dataset.strokes?d[s].dataset.answer=!0:(d[s].dataset.answer=!1,++i.stats.mistakes),++i.stats.solved;else{var r,o,l,c,d,u,p=t.querySelectorAll("#exercise .writing-zone-input");for(s=0,n=p.length;s<n;s++){for(r in o=!1,c=p[s].dataset,l=i.toHalfWidth(p[s].value).toLowerCase().replace(/。|、|^\s+|\s+$|\n/g,""),c)if(/answer/.test(r)){if(d=i.toHalfWidth(c[r]).toLowerCase().replace(/。|、|^\s+|\s+$|\n/g,""),/%\(.*?\)/.test(d))for(u=d.replace(/.*?%\((.*?)\).*/,"$1").split("/");u.length;){if(l==d.replace(/%\(.*?\)/,u[0])){o=!0;break}u.splice(0,1)}else l==d&&(o=!0);if(o)break}o?p[s].parentNode.className+=" answer-correct":(++c.mistakes,++i.stats.mistakes,"fill"==a&&p[s].parentNode.insertAdjacentHTML("beforeend",('<span class="problem-answer">'+c.answer+(c.answer2||c.furigana?'<span class="secondary-answer'+(c.furigana?" furigana-only":"")+'">'+(c.answer2||c.furigana)+"</span>":"")+"</span>").replace(/%\((.*?)\)/g,(function(e,t){return'<span class="alt-phrase">(</span>'+t.replace(/\//g,'<span class="alt-phrase-sep">/</span>')+'<span class="alt-phrase">)</span>'})))),++i.stats.solved,p[s].disabled=!0}}i.endQuiz(a||i.QuizType.WRITING)}})}},toggle:{exerciseList:function(e){e.className="list-open"==e.className?"":"list-open"},list:function(e){var t="lesson-title",i=t+" lesson-open";e.className=e.className==i?t:i;for(var a=e.parentNode.querySelectorAll(".lesson-title"),s=0,n=a.length;s<n;s++)a[s]!=e&&(a[s].className=t)},furigana:function(e){var a=t.getElementById("quiz-zone"),s=storageOK&&localStorage.furiganaVisible||(/helper-hidden/.test(a.className)?"false":"true");switch(s){case"true":s="false",a.className=a.className.replace("helper-present","helper-hidden"),e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":s="true",a.className=a.className.replace("helper-hidden","helper-present"),e.innerHTML=e.innerHTML.replace("Show","Hide")}i.lang.toggle_furigana=e.outerHTML,storageOK&&(localStorage.furiganaVisible=s)},vocabSpoiler:function(e){var t=e.nextSibling;/spoiler-off/.test(t.className)?(t.className=t.className.replace("spoiler-off",""),e.innerHTML=e.innerHTML.replace("Hide","Show")):(t.className+=" spoiler-off",e.innerHTML=e.innerHTML.replace("Show","Hide"))},vocabOrientation:function(e,i){var a=t.getElementById("quiz-zone"),s=void 0!==i?i:storageOK&&localStorage.vocabHorizontal||(/vocab-horizontal/.test(a.className)?"true":"false"),n=t.querySelectorAll(".quiz-answer-zone"),r=0,o=n.length;switch(s){case"true":s="false",a.className=a.className.replace(" vocab-horizontal",""),e.innerHTML=e.innerHTML.replace("Vertical","Horizontal"),e.querySelector("i").style.transform="rotate(90deg)";for(var l=t.getElementById("drop-list");r<o;r++)l.appendChild(n[r]);break;case"false":s="true",a.className+=" vocab-horizontal",e.innerHTML=e.innerHTML.replace("Horizontal","Vertical"),e.querySelector("i").style.transform="rotate(0deg)";for(var c=t.querySelectorAll(".quiz-item-group");r<o;r++)c[r].appendChild(n[r])}storageOK&&!i&&(localStorage.vocabHorizontal=s)},strokeNumbers:function(e){t.getElementById("quiz-zone");switch(i.strokeNumberDisplay){case!0:i.strokeNumberDisplay=!1,e.innerHTML=e.innerHTML.replace("Hide","Show");break;case!1:i.strokeNumberDisplay=!0,e.innerHTML=e.innerHTML.replace("Show","Hide")}for(var a=t.querySelectorAll(".kanji-canvas"),s=0,n=a.length;s<n;s++)KanjiCanvas["canvas_"+a[s].id]&&KanjiCanvas.redraw(a[s].id,!1,i.strokeNumberDisplay)},strokeOrder:function(e){var i=t.getElementById("quiz-zone"),a=storageOK&&localStorage.strokeOrderVisible||(/stroke-order-hidden/.test(i.className)?"false":"true");switch(a){case"true":a="false",i.className=i.className+=" stroke-order-hidden",e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":a="true",i.className=i.className.replace(" stroke-order-hidden",""),e.innerHTML=e.innerHTML.replace("Show","Hide")}storageOK&&(localStorage.strokeOrderVisible=a)},tracingGuide:function(e,i){t.getElementById("quiz-zone");var a=storageOK&&localStorage.tracingGuideVisible?localStorage.tracingGuideVisible:"true";switch(a){case"true":a="false",e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":a="true",e.innerHTML=e.innerHTML.replace("Show","Hide")}var s=t.querySelectorAll(".kanji-canvas"),n=0,r=s.length;if(i)for(var o=0,l="";n<r;n++)s[n].dataset.kanji!=l&&(l=s[n].dataset.kanji,o=0),o++<3&&(s[n].dataset.guide=a,KanjiCanvas["canvas_"+s[n].id]&&KanjiCanvas.redraw(s[n].id,!0));else for(;n<r;n++)s[n].dataset.guide=a,KanjiCanvas["canvas_"+s[n].id]&&KanjiCanvas.redraw(s[n].id,!0);storageOK&&(localStorage.tracingGuideVisible=a)},textSelection:function(e){var a=t.getElementById("quiz-zone");switch(i.textSelectMode){case!0:i.textSelectMode=!1,a.className=a.className.replace(" text-selection-mode",""),e.innerHTML=e.innerHTML.replace("Dis","En");break;case!1:i.textSelectMode=!0,a.className=a.className+=" text-selection-mode",e.innerHTML=e.innerHTML.replace("En","Dis")}}},create:{exerciseButtons:function(){for(var e,a='<div class="more-exercises clear">',s=2;s-- >0;)(e=i.exercises[1==s?i.active.index-1:i.active.index+1])&&!/^\.\.\//.test(e)&&(e=e.split("|"),a+='<a href="../../../'+i.ed+"/"+e[0]+"/"+i.local+i.debug+'" class="button '+(1==s?"prev":"next")+'-ex" title="'+(1==s?"Previous":"Next")+' exercise">'+e[1]+"</a>");t.getElementById("quiz-timer").insertAdjacentHTML("afterend",a+"</div>")},removeExerciseList:function(){var e=t.getElementById("exercise-list"),i=t.getElementById("toggle-exercises");e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i)},exerciseList:function(){var a='<div id="link-list" class="normal-block indent-block"><div><a id="link-home" class="button" href="'+getPaths()+(storageOK&&"3rd"==localStorage.GenkiEdition?"lessons-3rd/":"")+i.local+'"><i class="fa">&#xf015;</i>Home</a></div><div><a id="link-grammar" href="'+getPaths()+"lessons-3rd/appendix/grammar-index/"+i.local+'"><i class="fa">&#xf02d;</i>Grammar Index</a></div><div><a id="link-anki" href="'+getPaths()+"help/anki-decks/"+i.local+'"><i class="fa">&#xf005;</i>Anki Decks</a></div><div><a id="link-help" href="'+getPaths()+"help/"+i.local+'"><i class="fa">&#xf059;</i>Help &amp; FAQ</a></div><div><a id="link-report" href="'+getPaths()+"report/"+i.local+'"><i class="fa">&#xf188;</i>Reports &amp; Feedback</a></div><div><a id="link-download" href="'+getPaths()+"download/"+i.local+'"><i class="fa">&#xf019;</i>Download</a></div><div><a id="link-donate" href="'+getPaths()+"donate/"+i.local+'"><i class="fa">&#xf004;</i>Donate</a></div><div><a id="link-github" href="https://github.com/SethClydesdale/genki-study-resources"><i class="fa">&#xf09b;</i>GitHub</a></div><div><a id="link-settings" href="#genki-site-settings" onclick="GenkiSettings.manager(); return false;"><i class="fa">&#xf013;</i>Settings</a></div></div><div id="related" class="indent-block"><h3>Related Projects</h3><a href="https://sethclydesdale.github.io/tobira-study-resources/" title="Tobira Study Resources"><img src="'+getPaths()+'resources/images/tobira-img.png" alt="Tobira Study Resources"></a><a href="https://sethclydesdale.github.io/colloquial-kansai-dictionary/" title="Colloquial Kansai Japanese"><img src="'+getPaths()+'resources/images/kansai-img.png" alt="Colloquial Kansai Japanese"></a></div>';if(i.exercises){var s,n,r,o='class="lesson-title" onclick="Genki.toggle.list(this);" onkeydown="event.key == \'Enter\' && Genki.toggle.list(this);" tabindex="0"',l='<nav id="exercise-list"><h3 class="main-title">Exercise List</h3><button id="random-exercise" class="button" onclick="Genki.randomExercise();" title="Random Exercise"><i class="fa">&#xf074;</i></button><div id="lessons-list"><h4 '+o+'>Page links</h4><ul id="page-links">'+a+"</ul>",c="\\.\\.\\/",d=0,u=i.exercises.length,p="",g=/workbook-\d+|literacy-\d+|literacy-wb-\d+/,m={workbook:"Workbook",literacy:"Reading and Writing","literacy-wb":"Workbook: Reading and Writing"};if(storageOK&&(localStorage.GenkiEdition=/lessons-3rd/.test(e.location.pathname)?"3rd":"2nd",!localStorage.Results||!new RegExp(localStorage.GenkiEdition).test(localStorage.Results))){var h=localStorage.Results?JSON.parse(localStorage.Results):{};h[localStorage.GenkiEdition]={},localStorage.Results=JSON.stringify(h)}for(;d<u;d++){r=(s=i.exercises[d].split("|"))[0].replace(/^lesson-\d+\/|-\d+$/g,""),new RegExp(c).test(s[0])||(l+="</ul><h4 "+o+">"+(c=/^appendix/.test(s[0])?"appendix":/^study-tools/.test(s[0])?"study-tools":s[0].replace(/(lesson-\d+)\/.*/,"$1")).charAt(0).toUpperCase()+c.replace(/-/," ").slice(1)+'</h4><ul id="'+c+'">',p=""),g.test(s[0])&&p!=r&&(l+='<li><h4 class="sub-lesson-title">'+m[p=r]+"</h4></li>");var k=JSON.parse(localStorage.Results)[localStorage.GenkiEdition],v=k?parseInt(k[s[0]]):null,f={perfect:'<span class="exercise-results result--perfect" title="Exercise score"><i class="fa">&#xf005;</i> ',good:'<span class="exercise-results result--good" title="Exercise score"><i class="fa">&#xf00c;</i> ',average:'<span class="exercise-results result--average" title="Exercise score"><i class="fa">&#xf10c;</i> ',low:'<span class="exercise-results result--low" title="Exercise score"><i class="fa">&#xf00d;</i> '},b=v>-1?(100==v?f.perfect:v>=70?f.good:v>=50?f.average:f.low)+v+"%</span>":"";l+='<li class="menu-item-list"><a href="'+("\\.\\.\\/"==c?s[0]:"../../../"+i.ed+"/"+s[0]+"/")+i.local+i.debug+'" '+(s[2]?'data-page="Genki '+(+s[0].replace(/lesson-(\d+).*/,"$1")<13?"I":"II")+(/workbook-|wb-/.test(s[0])?" Workbook":"")+": "+s[2]+'"':"")+' title="'+s[1]+'">'+s[1]+"</a> "+b+"</li>"}t.getElementById("content").insertAdjacentHTML("afterbegin",'<a href="#toggle-exercises" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="Toggle exercise list"></a>'+l+"</ul></div></nav>"),i.active.exercise&&(i.toggle.list(t.getElementById(/^appendix/.test(i.active.exercise[0])?"appendix":/^study-tools/.test(i.active.exercise[0])?"study-tools":i.active.exercise[0].replace(/(lesson-\d+)\/.*/,"$1")).previousSibling),(n=t.querySelector('a[href*="'+i.active.exercise[0]+'"]:not(#link-grammar)')).className+=" active-lesson",n=n.parentNode,t.getElementById("lessons-list").scrollTop=n.offsetTop-(n.getBoundingClientRect().height+(e.matchMedia&&matchMedia("(pointer:coarse)").matches?0:6)))}else{var y='<a href="#toggle-navigation" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="Toggle quick navigation"></a><nav id="exercise-list"><h3 class="main-title">Quick Navigation</h3><div id="lessons-list">'+a+"</div></nav>";t.getElementById("content").insertAdjacentHTML("afterbegin",y)}},exerciseTypeButton:function(){var a=t.getElementById("quiz-timer"),s=t.createElement("DIV"),n=t.createElement("BUTTON");s.id="change-exercise-type-container",s.className="center",n.id="change-exercise-type",n.className="button",n.innerHTML='<i class="fa">&#xf021;</i> Changer le type d\'exercice',n.onclick=function(){GenkiModal.open({title:"Changer le type d'exercice ?",content:"Pour changer le type d'exercice, vous devez quitter l'exercice en cours. Voulez-vous quitter ?",buttonText:"Quitter",closeButtonText:"Annuler",keepOpen:!!(/\/dictionary\//.test(e.location)||!i.tools&&/"format"/.test(i.exerciseData)),callback:function(){if(/(?:begin|start)=\d/.test(e.location.search)){if(!e.history||!e.history.pushState)return void(e.location.search="");e.history.pushState({},t.title,e.location.href.replace(e.location.search,"")+i.debug)}i.changingExType=!0,i.reset()}})},s.appendChild(n),a.nextSibling?a.parentNode.insertBefore(s,a.nextSibling):a.parentNode.appendChild(s)}},parse:{image:function(e){var t=/^http/.test(e[1])?e[1]:"../../../resources/images/lesson-images/"+e[1];return'<a href="'+t+'" target="blank" title="View full image" class="lesson-image"><img src="'+t+'" alt="'+(e[2]||e[1])+'" /></a>'}},quickJisho:{hidden:!0,selectorHidden:!0,tabbing:!1,create:function(){if(!i.quickJisho.cache){var e=t.createElement("DIV"),a=t.createElement("DIV"),s=t.createElement("BUTTON"),n=t.createDocumentFragment();e.id="quick-jisho-toggle",e.innerHTML='<i class="fa">&#xf02d;</i>',e.title="Toggle Quick Dictionary",e.tabIndex=0,e.onclick=i.quickJisho.toggle,e.onkeypress=function(e){"Enter"==e.key&&i.quickJisho.toggle()},a.id="quick-jisho-window",a.className="quick-jisho-hidden",a.innerHTML='<div class="quick-jisho-header"><h3 id="quick-jisho-title" class="main-title"> Quick Dictionary <span id="quick-jisho-hits"></span> </h3> <i class="fa fa-hover" tabindex="0" onclick="Genki.quickJisho.toggle();" onkeydown="event.key == \'Enter\' && Genki.quickJisho.toggle();" title="Minimize">&#xf2d1;</i>  </div><div id="quick-jisho-content"><div class="quick-jisho-row center"><input tabindex="0" id="quick-jisho-search" type="text" placeholder="Search..." oninput="Genki.quickJisho.search(this.value);"></div><div class="quick-jisho-row"><ul id="quick-jisho-results"></ul></div></div>',s.id="quick-jisho-selector",s.className="button",s.style.display="none",s.innerHTML='<i class="fa">&#xf002;</i>Look up',s.onclick=i.quickJisho.lookUp,s.tabIndex=0,n.appendChild(a),n.appendChild(e),n.appendChild(s),t.body.appendChild(n),t.querySelector(".footer-right").style.marginRight="40px",i.quickJisho.cache={box:a,search:t.getElementById("quick-jisho-search"),results:t.getElementById("quick-jisho-results"),hits:t.getElementById("quick-jisho-hits"),selector:t.getElementById("quick-jisho-selector")},t.onselectionchange=i.quickJisho.getSelection,t.onmousemove=function(e){i.quickJisho.x=Math.abs(e.pageX-t.body.clientWidth)<100?e.pageX-95:e.pageX,i.quickJisho.y=Math.abs(e.pageY-t.body.clientHeight)<40?e.pageY-32:e.pageY+12},t.onkeydown=function(e){"Tab"!=e.key||i.quickJisho.selectorHidden||t.activeElement==i.quickJisho.cache.selector||(i.quickJisho.tabbing=!0,i.quickJisho.cache.selector.focus(),e.preventDefault())}}},toggle:function(){if(!i.jisho&&!i.quickJisho.loading){i.quickJisho.loading=!0;var e=t.createElement("SCRIPT");e.src=getPaths()+"resources/javascript/jisho.min.js",e.onload=function(){i.quickJisho.cache.search.value&&i.quickJisho.search(i.quickJisho.cache.search.value),i.quickJisho.loading=!1},t.body.appendChild(e)}i.quickJisho.hidden?(i.quickJisho.cache.box.className="",i.quickJisho.hidden=!1,i.quickJisho.cache.search.focus()):(i.quickJisho.cache.box.className="quick-jisho-hidden",i.quickJisho.hidden=!0)},search:function(t,a){i.quickJisho.searchTimeout&&e.clearTimeout(i.quickJisho.searchTimeout),i.quickJisho.searchTimeout=e.setTimeout((function(){var e,s,n,r,o,l="",c=0;if(i.quickJisho.cache.results.innerHTML="",t)for(e in t=t.toLowerCase(),i.jisho)for(s=0,n=i.jisho[e].length;s<n;s++)for(r in i.jisho[e][s])if(-1!=i.jisho[e][s][r].toLowerCase().indexOf(t)){l+='<li tabindex="0" class="definition clear"><span class="def-ja'+((o=i.jisho[e][s].ja.split("|"))[1]?" def-furi":"")+'">'+o[0]+(o[1]?"<i>"+o[1]+"</i>":"")+'</span><span class="def-en">'+i.jisho[e][s].en+"</span>"+(i.jisho[e][s].v?' <span class="def-vtype">[<i>'+i.jisho[e][s].v+"</i>]</span>":"")+'<span class="def-label">'+i.jisho[e][s].l+"</span>",c++;break}if(!a&&!l&&t&&/[\u3400-\u9faf]/.test(t)){var d=t.match(/[\u3400-\u9faf]+/);d&&d[0]&&i.quickJisho.search(d[0],!0)}else i.quickJisho.cache.results.innerHTML=l||(t?'<li>No results found for "'+t+'".</li>':""),i.quickJisho.cache.hits.innerHTML=c?"("+c+")":"";delete i.quickJisho.searchTimeout}),300)},lookUp:function(){i.quickJisho.hidden&&i.quickJisho.toggle(),i.quickJisho.cache.search.value="".trim?i.quickJisho.selectedText.trim():i.quickJisho.selectedText,i.quickJisho.search(i.quickJisho.cache.search.value),this.style.display="none",i.quickJisho.selectorHidden=!0},getSelection:function(){if(storageOK&&"false"==localStorage.genkiJishoLookUp)return!1;if(i.quickJisho.tabbing)return i.quickJisho.tabbingOff||(i.quickJisho.tabbingOff=setTimeout((function(){i.quickJisho.tabbing=!1,delete i.quickJisho.tabbingOff}),10)),!1;if(t.getSelection){var e=t.getSelection();"Range"==e.type&&e.toString&&!/quick-jisho/.test(e.focusNode.className)?(i.quickJisho.selectedText=e.toString(),i.quickJisho.cache.selector.style.left=i.quickJisho.x+"px",i.quickJisho.cache.selector.style.top=i.quickJisho.y+"px",i.quickJisho.selectorHidden&&(i.quickJisho.cache.selector.style.display="",i.quickJisho.selectorHidden=!1)):(i.quickJisho.selectedText="",i.quickJisho.selectorHidden||(i.quickJisho.cache.selector.style.display="none",i.quickJisho.selectorHidden=!0))}}},playAudio:function(e,i){var a=t.getElementById(e);a&&(a.currentTime=i,a.play())},viewStrokeOrder:function(e,t,i){var a=getPaths()+"resources/images/stroke-order/"+t+".png";GenkiModal.open({title:e+" Stroke Order",content:'<div class="kanji-stroke-order center"><div class="big-kanji'+(i?" kana-font":"")+'"'+(/り/.test(e)?' style="font-family:SawarabiGothic, MS Gothic, Yu Gothic, NotoSansJP, Meiryo;"':"")+">"+e+'</div><a class="button-link" href="'+(i?getPaths()+"resources/images/stroke-order/sasagami-"+i+".jpg":"https://jisho.org/search/"+e+"%20%23kanji")+'" target="_blank" title="View stroke order '+(i?"chart":"on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+a+'" target="_blank" title="Click to view image"><img src="'+a+'" alt="stroke order"/></a></div>'})},getAlts:function(e,t,a){for(var s,n,r,o=t.split("|"),l=o.length,c=Math.pow(2,l),d=[],u=0;u<c;++u)s=0,r=e.replace(/\{(.*?)\}/g,(function(e,t){return n=s++,1<<l-1-n&u?o[n]:t})),d.push(r);if(i.debug){var p=d.length;console[p/c*100==100?"log":"warn"](p+"/"+c+" ("+p/c*100+"% combo coverage for "+l+" replacements; "+(c-p)+" missing combos)",d)}return a?d:"%("+d.join("/")+")|"},getGrammarPoint:function(e,a){for(var s=e.parentNode;s;){if("genki-modal-content"==s.id){i.grammarPointHistory.push(s.innerHTML);break}if("BODY"==s.tagName||!s)break;s=s.parentNode}GenkiModal.open({title:"Quick Grammar Review",content:'<div id="appendix-tool" class="loading"></div>',customButton:(i.grammarPointHistory.length?'<button id="genki-modal-back" class="button" onclick="Genki.grammarPointBack(this);" title="Go back to previous grammar point."><i class="fa">&#xf112;</i>Back</button>':"")+'<a href="'+e.href+'" class="button" target="_blank"><i class="fa">&#xf08e;</i>View in Grammar Index</a>',customSize:{top:"10%",left:"20%",bottom:"10%",right:"20%"},zIndex:"low",closeCallback:function(){i.grammarPointHistory=[]}}),Get(e.href,(function(s){var n=t.querySelector("#genki-modal #appendix-tool"),r=s.match(new RegExp('(<h3 id="'+a+'"[\\s\\S]*?</table><br>)',"m")),o=s.match(new RegExp("(<style>[\\s\\S]*?</style>)","m")),l=e.href.replace(/#.*$/,"");r&&r[0]&&o&&o[0]?n&&(n.innerHTML=o[0]+r[0].replace(/\d+\. /,"").replace(/href="#(.*?)"/g,'onclick="Genki.getGrammarPoint(this, \'$1\'); return false;" target="_blank" href="'+l+'#$1"'),n.className="lessons"==i.ed?"second-ed":"third-ed"):n&&(n.innerHTML='<br><b>Failed to retrieve grammar point. Click "View in Grammar Index" to try viewing the grammar point directly.</b>',n.className="center")}))},grammarPointHistory:[],grammarPointBack:function(e){if(i.grammarPointHistory.length){var a=t.getElementById("genki-modal-content");a.innerHTML=i.grammarPointHistory.pop(),a.scrollTop=0,i.grammarPointHistory.length||(e.style.display="none")}},randomExercise:function(){if(storageOK&&"lesson"==localStorage.genkiRandomExercise&&/lesson-\d+/.test(e.location.href))var t=new RegExp(e.location.href.replace(/.*?(lesson-\d+).*/,"$1/")),a=i.exercises.filter((function(e){return t.test(e)}));else if(storageOK&&"completed"==localStorage.genkiRandomExercise&&localStorage.Results&&JSON.parse(localStorage.Results)[localStorage.GenkiEdition]){var s=JSON.parse(localStorage.Results)[localStorage.GenkiEdition];if(!(a=i.exercises.filter((function(e){return e.split("|")[0]in s})))[0])return alert("Cannot select a random exercise, because you have not completed enough exercises yet.")}else a=i.exercises;var n=a[Math.floor(Math.random()*a.length)].split("|");/lesson-\d+/.test(n[0])?e.location.href="../../../"+i.ed+"/"+n[0]+"/"+i.local+i.debug:i.randomExercise()},startOrPauseTimerByVisibility:function(){t.hidden&&i.timer.isRunning()?i.timer.pause():t.hidden||!i.timer.isPaused()||i.isTimerPausedByPopup||i.timer.start()},pauseTimerWhenOpenPopup:function(){i.timer.pause(),i.isTimerPausedByPopup=!0},startTimerWhenClosePopup:function(){i.timer.start(),i.isTimerPausedByPopup=!1},init:function(){if(i.exercises){for(var a,s=0,n=i.exercises.length,r=t.getElementById("quiz-result");s<n;s++)if(i.active.path==i.exercises[s].split("|")[0]){i.active.exercise=i.exercises[s]?i.exercises[s].split("|"):null,i.active.index=s;break}i.active.exercise?(a=/^appendix/.test(i.active.exercise[0])?"appendix":/^study-tools/.test(i.active.exercise[0])?"study-tools":+i.active.exercise[0].replace(/lesson-(\d+).*/,"$1"),r.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center" '+(i.active.exercise[2]?'data-page="Genki '+(a<13?"I":"II")+(/workbook-|wb-/.test(i.active.exercise[0])?" Workbook":"")+": "+i.active.exercise[2]+'"':"")+">"+("appendix"==a?"巻末":"study-tools"==a?"ツール":"第"+a+"課")+" - "+i.active.exercise[1]+"</h2>")):r.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center">'+t.querySelector("TITLE").innerText.replace(/\s\|.*/,"")+"</h2>"),i.isTouch&&(t.ontouchstart=function(){i.isTouching=!0},t.addEventListener("touchmove",(function(e){i.isTouching&&/hidden/i.test(t.body.style.overflow)&&e.preventDefault()}),{passive:!1}),t.ontouchend=function(){i.isTouching=!1},t.ontouchcancel=function(){i.isTouching=!1}),i.create.exerciseButtons()}i.create.exerciseList(),e.Genki=this}};e.onbeforeunload=function(){var e=!1,a=t.getElementById("exercise");if(a){if(a=a.className,/quiz-over/.test(a)||t.querySelector(".review-mode"))e=!1;else if(/fill-quiz|writing-quiz/.test(a)){for(var s=0,n=(r=t.querySelectorAll(".writing-zone-input")).length;s<n;s++)if(""!=r[s].value){e=!0;break}}else if(/drawing-quiz|stroke-quiz/.test(a)){var r;for(s=0,n=(r=t.querySelectorAll(".kanji-canvas")).length;s<n;s++)if(KanjiCanvas["recordedPattern_"+r[s].id].length){e=!0;break}}else/multi-quiz|drag-quiz|kana-quiz/.test(a)&&i.stats.solved>0&&(e=!0);if(e)return"Your progress will be lost. Do you want to continue?"}},i.init()}(window,document);